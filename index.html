<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Insignia - Premium Rewards with Live Chat</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      /* Modern Gradient Theme */
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --secondary: #f59e0b;
      --accent: #10b981;
      --danger: #ef4444;
      --dark: #0f172a;
      --dark-card: #1e293b;
      --darker: #0a0f1c;
      --light: #f8fafc;
      --gray: #64748b;
      --gray-light: #cbd5e1;
      --border: rgba(255, 255, 255, 0.1);
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 20px 40px -10px rgba(0, 0, 0, 0.4);
      --gradient: linear-gradient(135deg, #6366f1, #8b5cf6, #d946ef);
      --gradient-dark: linear-gradient(135deg, #0f172a, #1e1b4b);
      --radius: 16px;
      --radius-sm: 8px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--gradient-dark);
      color: var(--light);
      min-height: 100vh;
      overflow-x: hidden;
      line-height: 1.6;
      position: relative;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(219, 70, 239, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
    }

    /* Utility Classes */
    .hidden { display: none !important; }
    .flex { display: flex; }
    .flex-col { flex-direction: column; }
    .items-center { align-items: center; }
    .justify-center { justify-content: center; }
    .justify-between { justify-content: space-between; }
    .gap-2 { gap: 0.5rem; }
    .gap-4 { gap: 1rem; }
    .gap-6 { gap: 1.5rem; }
    .gap-8 { gap: 2rem; }
    .p-4 { padding: 1rem; }
    .p-6 { padding: 1.5rem; }
    .p-8 { padding: 2rem; }
    .mb-4 { margin-bottom: 1rem; }
    .mb-6 { margin-bottom: 1.5rem; }
    .mb-8 { margin-bottom: 2rem; }
    .text-center { text-align: center; }
    .text-sm { font-size: 0.875rem; }
    .text-lg { font-size: 1.125rem; }
    .text-xl { font-size: 1.25rem; }
    .text-2xl { font-size: 1.5rem; }
    .text-3xl { font-size: 1.875rem; }
    .text-4xl { font-size: 2.25rem; }
    .font-bold { font-weight: 700; }
    .font-semibold { font-weight: 600; }
    .w-full { width: 100%; }
    .h-full { height: 100%; }
    .relative { position: relative; }
    .absolute { position: absolute; }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    /* Loading Screen */
    #loadingScreen {
      position: fixed;
      inset: 0;
      background: var(--darker);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      backdrop-filter: blur(10px);
    }

    .loading-content {
      text-align: center;
      padding: 3rem;
      background: rgba(30, 41, 59, 0.8);
      border-radius: var(--radius);
      backdrop-filter: blur(20px);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-lg);
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 3px solid rgba(99, 102, 241, 0.3);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1.5rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* App Container */
    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Notification Styles */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 10000;
      max-width: 350px;
      pointer-events: none;
    }

    .notification {
      background: var(--gradient);
      color: white;
      padding: 15px 20px;
      margin-bottom: 10px;
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      display: flex;
      align-items: center;
      gap: 15px;
      transform: translateX(400px);
      opacity: 0;
      animation: slideIn 0.3s forwards, fadeOut 0.3s 4.7s forwards;
      border-left: 4px solid var(--secondary);
      pointer-events: all;
      cursor: pointer;
      transition: var(--transition);
    }

    .notification:hover {
      transform: translateY(-2px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    }

    .notification-icon {
      font-size: 1.5rem;
      animation: pulse 2s infinite;
    }

    @keyframes slideIn {
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    @keyframes fadeOut {
      to {
        opacity: 0;
        transform: translateX(400px);
      }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    /* Mobile notification banner */
    .mobile-notification-banner {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: var(--gradient);
      color: white;
      padding: 15px;
      text-align: center;
      z-index: 10001;
      display: none;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      cursor: pointer;
      animation: slideDown 0.3s forwards;
    }

    @keyframes slideDown {
      from { transform: translateY(-100%); }
      to { transform: translateY(0); }
    }

    /* Modern 9-Dot Navbar */
    .navbar {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 1000;
      padding: 1rem 0;
    }

    .nav-container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 1.5rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.5rem;
      font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }

    .logo-icon {
      width: 36px;
      height: 36px;
      background: var(--gradient);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    /* 9-Dot Menu */
    .menu-toggle {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      z-index: 1001;
    }

    .menu-toggle:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-2px);
    }

    .dots-menu {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 4px;
      width: 24px;
      height: 24px;
    }

    .dot {
      width: 6px;
      height: 6px;
      background: var(--primary-light);
      border-radius: 50%;
      transition: var(--transition);
    }

    .menu-toggle.active .dots-menu {
      display: none;
    }

    .menu-toggle.active::before {
      content: 'Ã—';
      font-size: 32px;
      color: var(--primary-light);
      line-height: 1;
      margin-top: -4px;
    }

    /* Mobile Menu */
    .mobile-menu {
      position: fixed;
      top: 0;
      right: 0;
      width: 320px;
      height: 100vh;
      background: rgba(15, 23, 42, 0.98);
      backdrop-filter: blur(30px);
      border-left: 1px solid var(--border);
      padding: 5rem 2rem 2rem;
      transform: translateX(100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      z-index: 999;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .mobile-menu.active {
      transform: translateX(0);
    }

    .menu-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      z-index: 998;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .menu-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-radius: var(--radius-sm);
      color: var(--light);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition);
      border: 1px solid transparent;
    }

    .menu-item:hover {
      background: rgba(99, 102, 241, 0.1);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateX(5px);
    }

    .menu-item.active {
      background: linear-gradient(90deg, rgba(99, 102, 241, 0.2), transparent);
      border-color: var(--primary);
      color: var(--primary-light);
    }

    .menu-item i {
      width: 24px;
      text-align: center;
      font-size: 1.1rem;
    }

    /* Desktop Nav */
    .desktop-nav {
      display: none;
      gap: 0.5rem;
      align-items: center;
    }

    @media (min-width: 1024px) {
      .desktop-nav {
        display: flex;
      }
      .menu-toggle {
        display: none;
      }
    }

    .nav-button {
      padding: 0.75rem 1.5rem;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.2);
      border-radius: var(--radius-sm);
      color: var(--light);
      font-weight: 500;
      text-decoration: none;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .nav-button:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2);
    }

    .nav-button.primary {
      background: var(--gradient);
      border: none;
      color: white;
    }

    /* Auth Screens */
    .auth-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem;
    }

    .auth-card {
      width: 100%;
      max-width: 440px;
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(20px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 2.5rem;
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .auth-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient);
    }

    .auth-title {
      font-size: 2rem;
      font-weight: 800;
      background: var(--gradient);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 0.5rem;
      text-align: center;
    }

    .auth-subtitle {
      color: var(--gray);
      text-align: center;
      margin-bottom: 2rem;
    }

    .input-group {
      margin-bottom: 1.5rem;
    }

    .input-label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--gray-light);
      font-weight: 500;
    }

    .input-field {
      width: 100%;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--light);
      font-size: 1rem;
      transition: var(--transition);
      outline: none;
    }

    .input-field:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .input-field::placeholder {
      color: var(--gray);
    }

    .btn {
      padding: 1rem 2rem;
      background: var(--gradient);
      border: none;
      border-radius: var(--radius-sm);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none !important;
    }

    .btn-outline {
      background: transparent;
      border: 2px solid var(--primary);
      color: var(--primary-light);
    }

    .auth-link {
      text-align: center;
      margin-top: 1.5rem;
      color: var(--gray);
    }

    .auth-link a {
      color: var(--primary-light);
      text-decoration: none;
      font-weight: 600;
      cursor: pointer;
    }

    .auth-link a:hover {
      text-decoration: underline;
    }

    /* Verification Code */
    .verification-container {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      margin: 2rem 0;
    }

    .code-input {
      width: 50px;
      height: 60px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      background: rgba(15, 23, 42, 0.6);
      border: 2px solid var(--border);
      border-radius: 10px;
      color: var(--light);
      transition: var(--transition);
    }

    .code-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
      transform: scale(1.05);
    }

    /* Dashboard */
    .dashboard {
      flex: 1;
      padding: 2rem 1rem;
    }

    /* Profile Header */
    .profile-header {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
      backdrop-filter: blur(20px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 2rem;
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }

    .avatar {
      width: 80px;
      height: 80px;
      background: var(--gradient);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2rem;
      font-weight: 700;
      color: white;
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
    }

    .user-info {
      flex: 1;
    }

    .username {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .user-status {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      border-radius: 20px;
      font-size: 0.875rem;
      font-weight: 600;
    }

    /* Balance Cards */
    .balance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .balance-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 1.5rem;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .balance-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient);
    }

    .balance-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .balance-label {
      color: var(--gray);
      font-size: 0.875rem;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .balance-value {
      font-size: 2rem;
      font-weight: 800;
      color: var(--light);
    }

    .balance-value.primary {
      color: var(--primary-light);
    }

    .balance-value.success {
      color: var(--accent);
    }

    /* Tabs Navigation */
    .tabs {
      display: flex;
      gap: 0.5rem;
      overflow-x: auto;
      padding: 0.5rem;
      margin-bottom: 2rem;
      background: rgba(15, 23, 42, 0.6);
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .tab-button {
      padding: 0.75rem 1.5rem;
      background: transparent;
      border: none;
      border-radius: var(--radius-sm);
      color: var(--gray);
      font-weight: 500;
      white-space: nowrap;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .tab-button:hover {
      background: rgba(99, 102, 241, 0.1);
      color: var(--light);
    }

    .tab-button.active {
      background: var(--gradient);
      color: white;
      box-shadow: 0 5px 15px rgba(99, 102, 241, 0.2);
    }

    /* Content Pages */
    .content-page {
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(20px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 2rem;
      margin-bottom: 2rem;
      min-height: 400px;
    }

    .page-title {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .page-title::after {
      content: '';
      flex: 1;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), transparent);
      margin-left: 1rem;
    }

    /* Work Page */
    .work-description {
      background: rgba(15, 23, 42, 0.6);
      border-radius: var(--radius-sm);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-left: 4px solid var(--primary);
    }

    .work-textarea {
      width: 100%;
      min-height: 150px;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--light);
      font-size: 1rem;
      margin-bottom: 1.5rem;
      resize: vertical;
      outline: none;
      transition: var(--transition);
    }

    .work-textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    /* Offerwalls */
    .offerwall-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
    }

    .offerwall-card {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 1.5rem;
      transition: var(--transition);
    }

    .offerwall-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
      border-color: var(--primary);
    }

    .offerwall-header {
      display: flex;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .offerwall-icon {
      width: 48px;
      height: 48px;
      background: var(--gradient);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.25rem;
    }

    .offerwall-status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .offerwall-status.unlocked {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent);
    }

    .offerwall-status.locked {
      background: rgba(239, 68, 68, 0.2);
      color: var(--danger);
    }

    /* Bonus Codes */
    .bonus-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .bonus-input-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .bonus-input {
      flex: 1;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--light);
      font-size: 1rem;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .bonus-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .bonus-item {
      background: rgba(15, 23, 42, 0.6);
      border-radius: var(--radius-sm);
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border: 1px solid var(--border);
      transition: var(--transition);
    }

    .bonus-item:hover {
      transform: translateX(5px);
      border-color: var(--primary);
    }

    .bonus-code {
      font-family: 'Courier New', monospace;
      font-weight: 700;
      color: var(--primary-light);
      font-size: 1.1rem;
    }

    .bonus-reward {
      color: var(--accent);
      font-weight: 600;
    }

    /* Cashout */
    .cashout-form {
      max-width: 400px;
      margin: 0 auto 2rem;
    }

    .reward-select {
      width: 100%;
      padding: 1rem;
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--light);
      font-size: 1rem;
      margin-bottom: 1.5rem;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236366f1'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 1.5rem;
    }

    .cashout-history {
      margin-top: 3rem;
    }

    .history-item {
      background: rgba(15, 23, 42, 0.6);
      border-radius: var(--radius-sm);
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 4px solid var(--primary);
      transition: var(--transition);
    }

    .history-item:hover {
      transform: translateX(5px);
    }

    .history-status {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    .status-pending { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    .status-approved { background: rgba(16, 185, 129, 0.2); color: #10b981; }
    .status-rejected { background: rgba(239, 68, 68, 0.2); color: #ef4444; }

    /* Enhanced Chat System */
    .chat-toggle {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      width: 60px;
      height: 60px;
      background: var(--gradient);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
      z-index: 990;
      transition: var(--transition);
    }

    .chat-toggle:hover {
      transform: scale(1.1) rotate(10deg);
    }

    .chat-box {
      position: fixed;
      bottom: 5rem;
      right: 2rem;
      width: 350px;
      height: 500px;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(20px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow-lg);
      display: flex;
      flex-direction: column;
      z-index: 989;
      transform: translateY(20px);
      opacity: 0;
      pointer-events: none;
      transition: var(--transition);
    }

    .chat-box.active {
      transform: translateY(0);
      opacity: 1;
      pointer-events: all;
    }

    .chat-header {
      padding: 1rem 1.5rem;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.2));
      border-radius: var(--radius) var(--radius) 0 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    .chat-unread-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: var(--danger);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      font-size: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(239, 68, 68, 0.3);
      animation: bounce 2s infinite;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-3px); }
    }

    .chat-messages {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .chat-message {
      max-width: 80%;
      padding: 12px 16px;
      border-radius: 18px;
      font-size: 0.9rem;
      line-height: 1.4;
      position: relative;
      margin-bottom: 8px;
      word-wrap: break-word;
    }

    .chat-message.own {
      background: var(--gradient);
      color: white;
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }

    .chat-message.other {
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid rgba(99, 102, 241, 0.3);
      align-self: flex-start;
      border-bottom-left-radius: 4px;
    }

    .message-time {
      font-size: 0.7rem;
      opacity: 0.7;
      margin-top: 4px;
      text-align: right;
    }

    .chat-input-container {
      padding: 15px;
      border-top: 1px solid var(--border);
      display: flex;
      gap: 10px;
      align-items: center;
      background: rgba(15, 23, 42, 0.8);
    }

    .chat-input {
      flex: 1;
      padding: 12px 16px;
      background: rgba(30, 41, 59, 0.8);
      border: 1px solid var(--border);
      border-radius: 25px;
      color: var(--light);
      font-size: 0.9rem;
      outline: none;
      transition: var(--transition);
    }

    .chat-input:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
    }

    .chat-actions {
      display: flex;
      gap: 5px;
    }

    .chat-action-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(99, 102, 241, 0.1);
      border: 1px solid rgba(99, 102, 241, 0.2);
      color: var(--primary-light);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }

    .chat-action-btn:hover {
      background: rgba(99, 102, 241, 0.2);
      transform: scale(1.1);
    }

    .typing-indicator {
      display: flex;
      gap: 4px;
      padding: 10px 15px;
      background: rgba(30, 41, 59, 0.6);
      border-radius: 15px;
      margin-left: 10px;
      align-self: flex-start;
      display: none;
    }

    .typing-dot {
      width: 8px;
      height: 8px;
      background: var(--primary-light);
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-5px); }
    }

    /* Online Status */
    .online-status {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.8rem;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
      animation: pulse 2s infinite;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal {
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(30px);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 2rem;
      max-width: 400px;
      width: 90%;
      box-shadow: var(--shadow-lg);
      transform: translateY(20px);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
      transform: translateY(0);
    }

    .modal-message {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--light);
      font-size: 1.1rem;
    }

    /* Footer */
    .footer {
      background: rgba(15, 23, 42, 0.8);
      border-top: 1px solid var(--border);
      padding: 2rem 1rem;
      margin-top: auto;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      text-align: center;
      color: var(--gray);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 0 0.75rem;
      }
      
      .notification-container {
        top: 60px;
        right: 10px;
        left: 10px;
        max-width: none;
      }
      
      .notification {
        padding: 12px 15px;
      }
      
      .auth-card {
        padding: 1.5rem;
      }
      
      .profile-header {
        flex-direction: column;
        text-align: center;
      }
      
      .balance-grid {
        grid-template-columns: 1fr;
      }
      
      .offerwall-grid,
      .bonus-grid {
        grid-template-columns: 1fr;
      }
      
      .bonus-input-group {
        flex-direction: column;
      }
      
      .chat-box {
        width: calc(100% - 20px);
        height: 70vh;
        bottom: 70px;
        right: 10px;
      }
      
      .tabs {
        padding: 0.25rem;
        gap: 0.25rem;
      }
      
      .tab-button {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
      
      .verification-container {
        gap: 0.5rem;
      }
      
      .code-input {
        width: 40px;
        height: 50px;
        font-size: 1.25rem;
      }
      
      .mobile-notification-banner {
        display: block;
      }
      
      .chat-toggle {
        width: 50px;
        height: 50px;
        font-size: 1.25rem;
        bottom: 1rem;
        right: 1rem;
      }
    }

    @media (max-width: 480px) {
      .content-page {
        padding: 1.5rem;
      }
      
      .auth-card {
        padding: 1.25rem;
      }
      
      .auth-title {
        font-size: 1.75rem;
      }
      
      .page-title {
        font-size: 1.5rem;
      }
      
      .balance-value {
        font-size: 1.75rem;
      }
      
      .mobile-menu {
        width: 280px;
        padding: 4rem 1.5rem 1.5rem;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="loadingScreen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2 class="text-2xl font-bold mb-2">Loading Insignia</h2>
      <p class="text-gray">Initializing premium experience...</p>
    </div>
  </div>

  <!-- Notification Container -->
  <div class="notification-container" id="notificationContainer"></div>

  <!-- Mobile Notification Banner -->
  <div class="mobile-notification-banner" id="mobileNotificationBanner">
    <i class="fas fa-comment-alt"></i> New message received! Tap to open chat.
  </div>

  <!-- App Container -->
  <div id="app" class="hidden">
    <!-- Navbar -->
    <nav class="navbar">
      <div class="container nav-container">
        <!-- Logo -->
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-crown"></i>
          </div>
          <span>Insignia</span>
        </div>

        <!-- Desktop Navigation -->
        <div class="desktop-nav">
          <a href="#" class="nav-button" onclick="showPage('work')">
            <i class="fas fa-briefcase"></i>
            Tasks
          </a>
          <a href="#" class="nav-button" onclick="showPage('offerwalls')">
            <i class="fas fa-gem"></i>
            Offerwalls
          </a>
          <a href="#" class="nav-button" onclick="showPage('bonus')">
            <i class="fas fa-gift"></i>
            Bonus
          </a>
          <a href="#" class="nav-button" onclick="showPage('cashout')">
            <i class="fas fa-wallet"></i>
            Cashout
          </a>
          <a href="#" class="nav-button" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i>
            Logout
          </a>
        </div>

        <!-- 9-Dot Menu Toggle -->
        <button class="menu-toggle" onclick="toggleMenu()">
          <div class="dots-menu">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
          </div>
        </button>
      </div>
    </nav>

    <!-- Mobile Menu Overlay -->
    <div class="menu-overlay" onclick="toggleMenu()"></div>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
      <a href="#" class="menu-item active" onclick="showPage('work'); toggleMenu()">
        <i class="fas fa-briefcase"></i>
        <span>Tasks</span>
      </a>
      <a href="#" class="menu-item" onclick="showPage('offerwalls'); toggleMenu()">
        <i class="fas fa-gem"></i>
        <span>Offerwalls</span>
      </a>
      <a href="#" class="menu-item" onclick="showPage('bonus'); toggleMenu()">
        <i class="fas fa-gift"></i>
        <span>Bonus Codes</span>
      </a>
      <a href="#" class="menu-item" onclick="showPage('cashout'); toggleMenu()">
        <i class="fas fa-wallet"></i>
        <span>Cashout</span>
      </a>
      <a href="#" class="menu-item" onclick="showPage('terms'); toggleMenu()">
        <i class="fas fa-file-contract"></i>
        <span>Terms</span>
      </a>
      <a href="#" class="menu-item" onclick="toggleChat(); toggleMenu()">
        <i class="fas fa-comments"></i>
        <span>Support</span>
      </a>
      <a href="#" class="menu-item" onclick="showAlert('Contact: support@insignia.com'); toggleMenu()">
        <i class="fas fa-question-circle"></i>
        <span>Help</span>
      </a>
      <a href="#" class="menu-item" onclick="logout(); toggleMenu()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </a>
    </div>

    <!-- Auth Screens -->
    <div id="authScreens">
      <div class="auth-container">
        <!-- Login Card -->
        <div id="loginCard" class="auth-card">
          <h1 class="auth-title">Welcome Back</h1>
          <p class="auth-subtitle">Sign in to access your premium account</p>
          
          <div class="input-group">
            <label class="input-label">Username</label>
            <input type="text" id="loginUsername" class="input-field" placeholder="Enter your username" autocomplete="off">
          </div>
          
          <div class="input-group">
            <label class="input-label">Password</label>
            <input type="password" id="loginPassword" class="input-field" placeholder="Enter your password" autocomplete="off">
          </div>
          
          <button class="btn" onclick="login()">
            <i class="fas fa-sign-in-alt"></i>
            Access Account
          </button>
          
          <div class="auth-link">
            New to Insignia? <a onclick="showSignup()">Create account</a>
          </div>
        </div>

        <!-- Signup Card -->
        <div id="signupCard" class="auth-card hidden">
          <h1 class="auth-title">Join Insignia</h1>
          <p class="auth-subtitle">Create your premium account today</p>
          
          <div class="input-group">
            <label class="input-label">Username</label>
            <input type="text" id="signupUsername" class="input-field" placeholder="Choose a username" autocomplete="off">
          </div>
          
          <div class="input-group">
            <label class="input-label">Email</label>
            <input type="email" id="signupEmail" class="input-field" placeholder="Enter your email" autocomplete="off">
          </div>
          
          <div class="input-group">
            <label class="input-label">Password</label>
            <input type="password" id="signupPassword" class="input-field" placeholder="Create a password" autocomplete="off">
          </div>
          
          <button class="btn" onclick="signup()">
            <i class="fas fa-user-plus"></i>
            Create Account
          </button>
          
          <div class="auth-link">
            Already have an account? <a onclick="showLogin()">Sign in</a>
          </div>
        </div>

        <!-- Verification Card -->
        <div id="verifyCard" class="auth-card hidden">
          <h1 class="auth-title">Verify Identity</h1>
          <p class="auth-subtitle">Enter the 6-digit code sent to your email</p>
          
          <div class="verification-container">
            <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 1)" autocomplete="off">
            <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 2)" autocomplete="off">
            <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 3)" autocomplete="off">
            <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 4)" autocomplete="off">
            <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 5)" autocomplete="off">
            <input type="text" class="code-input" maxlength="1" oninput="moveToNext(this, 6)" autocomplete="off">
          </div>
          
          <button class="btn" onclick="verifyEmail()">
            <i class="fas fa-check-circle"></i>
            Verify & Continue
          </button>
          
          <div class="auth-link">
            Didn't receive code? <a onclick="resendCode()">Resend</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard hidden">
      <div class="container">
        <!-- Profile Header -->
        <div class="profile-header">
          <div class="avatar" id="userAvatar">U</div>
          <div class="user-info">
            <h2 class="username" id="displayUsername">User</h2>
            <span id="userStatus" class="user-status">Premium</span>
          </div>
        </div>

        <!-- Balance Cards -->
        <div class="balance-grid">
          <div class="balance-card">
            <div class="balance-label">Points Balance</div>
            <div class="balance-value primary" id="balanceValue">0</div>
          </div>
          <div class="balance-card">
            <div class="balance-label">USD Balance</div>
            <div class="balance-value" id="usdBalanceValue">$0.0000</div>
          </div>
          <div class="balance-card">
            <div class="balance-label">Bonus Points</div>
            <div class="balance-value success" id="bonusPointsValue">0</div>
          </div>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs">
          <button class="tab-button active" onclick="showPage('work')">
            <i class="fas fa-briefcase"></i>
            Tasks
          </button>
          <button class="tab-button" onclick="showPage('offerwalls')">
            <i class="fas fa-gem"></i>
            Offerwalls
          </button>
          <button class="tab-button" onclick="showPage('bonus')">
            <i class="fas fa-gift"></i>
            Bonus Codes
          </button>
          <button class="tab-button" onclick="showPage('cashout')">
            <i class="fas fa-wallet"></i>
            Cashout
          </button>
          <button class="tab-button" onclick="showPage('terms')">
            <i class="fas fa-file-contract"></i>
            Terms
          </button>
        </div>

        <!-- Content Pages -->
        <div id="pages">
          <!-- Work Page -->
          <div id="work" class="content-page">
            <h2 class="page-title">
              <i class="fas fa-briefcase"></i>
              Complete Tasks
            </h2>
            
            <div class="work-description">
              <p><strong>How it works:</strong></p>
              <p>Each question you read and each answer you submit earns you rewards</p>
              <p>5 Points + $0.005 USD for each approved submission</p>
            </div>
            
            <textarea id="workInput" class="work-textarea" placeholder="Describe what questions you answered today..."></textarea>
            
            <button class="btn" onclick="submitWork()">
              <i class="fas fa-paper-plane"></i>
              Submit Work
            </button>
          </div>

          <!-- Offerwalls Page -->
          <div id="offerwalls" class="content-page hidden">
            <h2 class="page-title">
              <i class="fas fa-gem"></i>
              Offerwalls
            </h2>
            
            <div id="offerwallList" class="offerwall-grid">
              <p>Loading offerwalls...</p>
            </div>
            
            <div id="iframeContainer" class="hidden">
              <iframe id="offerwallFrame" class="w-full" style="height: 600px; border: none; border-radius: var(--radius);"></iframe>
            </div>
          </div>

          <!-- Bonus Codes Page -->
          <div id="bonus" class="content-page hidden">
            <h2 class="page-title">
              <i class="fas fa-gift"></i>
              Bonus Codes
            </h2>
            
            <div class="bonus-grid">
              <div class="balance-card">
                <h3 class="font-semibold mb-4">Redeem Code</h3>
                <div class="bonus-input-group">
                  <input type="text" id="bonusCodeInput" class="bonus-input" placeholder="ENTER-CODE-HERE" maxlength="20">
                  <button class="btn" onclick="redeemBonusCode()">
                    <i class="fas fa-ticket-alt"></i>
                    Redeem
                  </button>
                </div>
              </div>
              
              <div class="balance-card">
                <h3 class="font-semibold mb-4">Available Codes</h3>
                <div id="availableBonusCodes" class="bonus-list">
                  <p>Loading available codes...</p>
                </div>
              </div>
            </div>
            
            <div class="balance-card">
              <h3 class="font-semibold mb-4">Redemption History</h3>
              <div id="bonusHistory">
                <p>Loading redemption history...</p>
              </div>
            </div>
          </div>

          <!-- Cashout Page -->
          <div id="cashout" class="content-page hidden">
            <h2 class="page-title">
              <i class="fas fa-wallet"></i>
              Request Cashout
            </h2>
            
            <div class="work-description">
              <p><strong>Cashout Information:</strong></p>
              <p>1 USD = 1000 PTS</p>
              <p>Minimum cashout: $5.00</p>
            </div>
            
            <div class="cashout-form">
              <select id="rewardSelect" class="reward-select">
                <option value="">Select reward...</option>
              </select>
              
              <button id="cashoutBtn" class="btn" onclick="submitCashout()" disabled>
                <i class="fas fa-coins"></i>
                Request Cashout
              </button>
            </div>
            
            <div class="cashout-history">
              <h3 class="font-semibold mb-4">Cashout History</h3>
              <div id="cashoutHistory">
                <p>Loading history...</p>
              </div>
            </div>
          </div>

          <!-- Terms Page -->
          <div id="terms" class="content-page hidden">
            <h2 class="page-title">
              <i class="fas fa-file-contract"></i>
              Terms & Conditions
            </h2>
            
            <div id="termsContent">
              <div class="work-description">
                <h3 class="font-semibold mb-3">1. Account Terms</h3>
                <p>â€¢ Users must be at least 18 years old to create an account</p>
                <p>â€¢ One account per person is allowed</p>
                <p>â€¢ You are responsible for maintaining the security of your account</p>
                
                <h3 class="font-semibold mb-3 mt-4">2. Earnings & Withdrawals</h3>
                <p>â€¢ Minimum withdrawal: $5.00 USD</p>
                <p>â€¢ Withdrawals are processed within 3-7 business days</p>
                <p>â€¢ All earnings are subject to verification</p>
                
                <h3 class="font-semibold mb-3 mt-4">3. Prohibited Activities</h3>
                <p>â€¢ Using automated scripts or bots</p>
                <p>â€¢ Creating multiple accounts</p>
                <p>â€¢ Attempting to cheat the system</p>
                <p>â€¢ Using VPNs or proxy services</p>
                
                <h3 class="font-semibold mb-3 mt-4">4. Privacy Policy</h3>
                <p>â€¢ We collect necessary data for account operation</p>
                <p>â€¢ We never share your personal information with third parties</p>
                <p>â€¢ Your data is protected with encryption</p>
                
                <h3 class="font-semibold mb-3 mt-4">5. Support</h3>
                <p>â€¢ Contact: support@insignia.com</p>
                <p>â€¢ Response time: 24-48 hours</p>
                <p>â€¢ Live chat available during business hours</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="footer-content">
        <p>Â© 2024 Insignia Premium Rewards. All rights reserved.</p>
        <p class="text-sm mt-2">Product â€¢ Usecases â€¢ Resources â€¢ Company</p>
      </div>
    </footer>
  </div>

  <!-- Enhanced Chat System -->
  <button id="chatToggle" class="chat-toggle hidden">
    <i class="fas fa-comment-dots"></i>
    <span class="chat-unread-badge" id="unreadBadge" style="display: none;">0</span>
  </button>
  
  <div id="chatBox" class="chat-box">
    <div class="chat-header">
      <div style="display: flex; align-items: center; gap: 10px;">
        <i class="fas fa-headset"></i>
        <div>
          <div><strong>Premium Support</strong></div>
          <div class="online-status">
            <span class="status-dot"></span>
            <span>Live Support</span>
          </div>
        </div>
      </div>
      <div style="display: flex; align-items: center; gap: 10px;">
        <span id="typingIndicator" class="typing-indicator" style="display: none;">
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
          <div class="typing-dot"></div>
        </span>
        <button class="chat-close" onclick="toggleChat()">Ã—</button>
      </div>
    </div>
    
    <div class="chat-messages" id="chatMessages">
      <div class="chat-message other">
        <strong>Insignia Support:</strong> Welcome to Insignia Premium! How can we assist you today?
        <div class="message-time">Just now</div>
      </div>
    </div>
    
    <div class="chat-input-container">
      <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." 
             onkeypress="handleChatInput(event)" autocomplete="off">
      <div class="chat-actions">
        <button class="chat-action-btn" onclick="sendEmoji('ðŸ‘')">
          <i class="fas fa-thumbs-up"></i>
        </button>
        <button class="chat-action-btn" onclick="sendEmoji('â¤ï¸')">
          <i class="fas fa-heart"></i>
        </button>
        <button class="chat-action-btn" onclick="sendChatMessage()" id="sendButton">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="alertModal" class="modal-overlay">
    <div class="modal">
      <p id="alertMessage" class="modal-message">Message</p>
      <button class="btn" onclick="closeAlert()">Continue</button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // Main App State
    const state = {
      user: null,
      currentPage: 'work',
      menuOpen: false,
      chatOpen: false,
      loading: false,
      pendingUser: null
    };

    // Script URLs - USE THESE EXACT URLs
    const MAIN_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwTelvEYce1YEgw8-RDKth6xa_VJGRu2YOTxRMcgTGLuL6IXgO7tFG3xllYW4czAdbEEg/exec";
    const CHAT_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzAvcV5E2B7DwA_qoNly5atw1lmwhxYqRxOY-uw_xdIfylejFMiSeZdyBSVrBijLONZ/exec";

    // Chat System Class - SIMPLIFIED AND WORKING
    class ChatSystem {
      constructor() {
        this.unreadCount = 0;
        this.lastMessageId = null;
        this.pollingInterval = null;
        this.notificationPermission = null;
        this.isInitialized = false;
        this.sheetId = "1BiCmOAUpalwQw8HysbShtEYzf3zq3Zxjiy2-eDdU6t0";
      }
      
      async initialize() {
        if (this.isInitialized) return;
        
        // Request notification permission
        await this.requestNotificationPermission();
        
        // Load existing messages
        await this.loadChatMessages();
        
        // Start polling for new messages
        this.startPolling();
        
        // Setup event listeners
        this.setupEventListeners();
        
        this.isInitialized = true;
        console.log('Chat system initialized');
      }
      
      async requestNotificationPermission() {
        if (!("Notification" in window)) {
          console.log("This browser does not support notifications");
          return;
        }
        
        try {
          if (Notification.permission === "default") {
            this.notificationPermission = await Notification.requestPermission();
          } else {
            this.notificationPermission = Notification.permission;
          }
          console.log("Notification permission:", this.notificationPermission);
        } catch (error) {
          console.error("Error requesting notification permission:", error);
        }
      }
      
      setupEventListeners() {
        // Chat toggle
        document.getElementById('chatToggle').addEventListener('click', () => this.toggleChat());
        
        // Mobile notification banner
        document.getElementById('mobileNotificationBanner').addEventListener('click', () => {
          this.toggleChat();
          this.hideMobileBanner();
        });
      }
      
      async loadChatMessages() {
        if (!state.user) return;
        
        try {
          const response = await fetch(`${CHAT_SCRIPT_URL}?action=getChatMessages&username=${encodeURIComponent(state.user.username)}&t=${Date.now()}`);
          const data = await response.json();
          
          if (data.status === 'success') {
            this.renderMessages(data.messages || []);
            this.updateUnreadCount(data.unreadCount || 0);
            
            // Store last message ID
            if (data.messages && data.messages.length > 0) {
              this.lastMessageId = data.messages[data.messages.length - 1].id;
            }
          } else {
            console.error('Failed to load messages:', data.message);
          }
        } catch (error) {
          console.error('Error loading chat messages:', error);
          this.renderMessages([]);
        }
      }
      
      renderMessages(messages) {
        const container = document.getElementById('chatMessages');
        
        if (!messages || messages.length === 0) {
          container.innerHTML = `
            <div class="chat-message other">
              <strong>Insignia Support:</strong> Welcome! Start the conversation...
              <div class="message-time">Just now</div>
            </div>
          `;
          return;
        }
        
        container.innerHTML = messages.map(msg => {
          const isOwn = msg.sender === state.user.username;
          const time = new Date(msg.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
          const senderName = isOwn ? 'You' : (msg.sender === 'support' ? 'Insignia Support' : msg.sender);
          
          return `
            <div class="chat-message ${isOwn ? 'own' : 'other'}">
              <strong>${senderName}:</strong> ${msg.message}
              <div class="message-time">${time}</div>
            </div>
          `;
        }).join('');
        
        container.scrollTop = container.scrollHeight;
      }
      
      updateUnreadCount(count) {
        this.unreadCount = count;
        const badge = document.getElementById('unreadBadge');
        
        if (count > 0) {
          badge.textContent = count > 99 ? '99+' : count;
          badge.style.display = 'flex';
          
          if (!document.getElementById('chatBox').classList.contains('active')) {
            document.title = `(${count}) New Message! - Insignia`;
            this.showNotification('NEW MESSAGE ALERT!', `You have ${count} unread message${count > 1 ? 's' : ''}`);
          }
        } else {
          badge.style.display = 'none';
          if (!document.getElementById('chatBox').classList.contains('active')) {
            document.title = 'Insignia - Premium Rewards';
          }
        }
      }
      
      async sendMessage(message = null) {
        if (!state.user) {
          console.error('No user logged in');
          return;
        }
        
        const input = document.getElementById('chatInput');
        const msg = message || input.value.trim();
        
        if (!msg) {
          console.log('Empty message, not sending');
          return;
        }
        
        console.log('Sending message:', msg, 'from user:', state.user.username);
        
        // Clear input immediately
        if (!message) {
          input.value = '';
        }
        
        // Show message immediately in chat
        const container = document.getElementById('chatMessages');
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        container.innerHTML += `
          <div class="chat-message own">
            <strong>You:</strong> ${msg}
            <div class="message-time">${time} (Sending...)</div>
          </div>
        `;
        container.scrollTop = container.scrollHeight;
        
        // Send to server using FormData (POST)
        try {
          const formData = new FormData();
          formData.append('action', 'sendMessage');
          formData.append('sender', state.user.username);
          formData.append('message', msg);
          formData.append('recipient', 'support');
          formData.append('sheetId', this.sheetId);
          
          console.log('Sending FormData:', {
            action: 'sendMessage',
            sender: state.user.username,
            message: msg,
            recipient: 'support',
            sheetId: this.sheetId
          });
          
          const response = await fetch(CHAT_SCRIPT_URL, { 
            method: 'POST', 
            body: formData 
          });
          
          const data = await response.json();
          console.log('Send response:', data);
          
          if (data.status === 'success') {
            // Update message status
            const lastMessage = container.querySelector('.chat-message.own:last-child .message-time');
            if (lastMessage) {
              lastMessage.textContent = time;
            }
            
            // Reload messages
            await this.loadChatMessages();
            
            // Show success notification
            this.showDesktopNotification('Message Sent!', 'Your message was delivered successfully');
          } else {
            console.error('Failed to send message:', data.message);
            showAlert('Failed to send message: ' + data.message);
          }
        } catch (error) {
          console.error('Error sending message:', error);
          showAlert('Network error. Please try again.');
        }
      }
      
      startPolling() {
        if (this.pollingInterval) {
          clearInterval(this.pollingInterval);
        }
        
        this.pollingInterval = setInterval(async () => {
          if (state.user) {
            await this.checkNewMessages();
          }
        }, 5000);
      }
      
      async checkNewMessages() {
        try {
          const response = await fetch(`${CHAT_SCRIPT_URL}?action=checkNewMessages&username=${encodeURIComponent(state.user.username)}&lastId=${this.lastMessageId || ''}&t=${Date.now()}`);
          const data = await response.json();
          
          if (data.status === 'success' && data.newMessages > 0) {
            console.log('New messages found:', data.newMessages);
            await this.loadChatMessages();
            
            if (document.getElementById('chatBox').classList.contains('active')) {
              await this.markAsRead();
            }
          }
        } catch (error) {
          console.error('Error checking new messages:', error);
        }
      }
      
      async markAsRead() {
        try {
          await fetch(`${CHAT_SCRIPT_URL}?action=markAsRead&username=${encodeURIComponent(state.user.username)}&t=${Date.now()}`);
          this.updateUnreadCount(0);
        } catch (error) {
          console.error('Error marking as read:', error);
        }
      }
      
      showNotification(title, body) {
        // Show mobile banner
        if (window.innerWidth <= 768) {
          this.showMobileBanner(title);
        }
        
        // Show desktop notification if allowed
        if (this.notificationPermission === "granted") {
          this.showDesktopNotification(title, body);
        } else {
          this.showCustomNotification(title, body);
        }
      }
      
      showMobileBanner(title) {
        const banner = document.getElementById('mobileNotificationBanner');
        banner.innerHTML = `<i class="fas fa-comment-alt"></i> ${title}`;
        banner.style.display = 'block';
        
        setTimeout(() => this.hideMobileBanner(), 5000);
      }
      
      hideMobileBanner() {
        const banner = document.getElementById('mobileNotificationBanner');
        banner.style.display = 'none';
      }
      
      showDesktopNotification(title, body) {
        try {
          const notification = new Notification(title, {
            body: body,
            icon: 'https://cdn-icons-png.flaticon.com/512/733/733585.png',
            tag: 'insignia-chat'
          });
          
          notification.onclick = () => {
            window.focus();
            this.toggleChat();
            notification.close();
          };
          
          setTimeout(() => notification.close(), 10000);
        } catch (error) {
          console.error('Error showing desktop notification:', error);
        }
      }
      
      showCustomNotification(title, body) {
        const notificationContainer = document.getElementById('notificationContainer');
        const notificationId = 'notification-' + Date.now();
        
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.id = notificationId;
        notification.innerHTML = `
          <div class="notification-icon">
            <i class="fas fa-comment-alt"></i>
          </div>
          <div>
            <strong>${title}</strong><br>
            <span>${body}</span>
          </div>
        `;
        
        notification.addEventListener('click', () => {
          this.toggleChat();
          notification.remove();
        });
        
        notificationContainer.appendChild(notification);
        
        setTimeout(() => {
          const el = document.getElementById(notificationId);
          if (el) el.remove();
        }, 5000);
      }
      
      toggleChat() {
        const chatBox = document.getElementById('chatBox');
        const isActive = chatBox.classList.toggle('active');
        
        if (isActive) {
          this.markAsRead();
          document.getElementById('chatInput').focus();
        }
      }
      
      cleanup() {
        if (this.pollingInterval) {
          clearInterval(this.pollingInterval);
          this.pollingInterval = null;
        }
        this.isInitialized = false;
      }
    }

    // Global chat instance
    let chatSystem = null;

    // Initialize app
    async function init() {
      console.log('ðŸš€ Initializing Insignia...');
      
      try {
        const response = await fetch(MAIN_SCRIPT_URL + '?action=test&t=' + Date.now());
        const data = await response.json();
        
        if (data.status === 'success') {
          console.log('âœ… Connection successful');
          
          // Load configuration
          const configResponse = await fetch(MAIN_SCRIPT_URL + '?action=getConfig&t=' + Date.now());
          const config = await configResponse.json();
          
          if (config.status === 'success') {
            applyConfig(config);
          }
          
          // Show app
          setTimeout(() => {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('app').classList.remove('hidden');
            
            // Try auto-login
            const saved = localStorage.getItem('insignia_user');
            if (saved) {
              const userData = JSON.parse(saved);
              restoreSession(userData.username);
            }
          }, 1000);
          
        } else {
          throw new Error('Connection failed');
        }
      } catch (error) {
        console.error('âŒ Initialization error:', error);
        document.getElementById('loadingScreen').classList.add('hidden');
        document.getElementById('app').classList.remove('hidden');
        showAlert('Connection error. Please check your internet.');
      }
    }

    function applyConfig(config) {
      if (config.texts && config.texts.terms) {
        document.getElementById('termsContent').innerHTML = config.texts.terms;
      }
      
      if (config.app_name) {
        document.title = config.app_name;
      }
      
      if (config.logo) {
        document.querySelector('.logo-icon').innerHTML = `<img src="${config.logo}" alt="Logo" style="width: 24px; height: 24px;">`;
      }
      
      // Load offers
      const select = document.getElementById('rewardSelect');
      if (config.offers && config.offers.length > 0) {
        config.offers.forEach(offer => {
          const option = document.createElement('option');
          option.value = offer.amount;
          option.textContent = `${offer.name} ($${offer.amount})`;
          select.appendChild(option);
        });
      }
    }

    // Auth functions
    function showLogin() {
      document.getElementById('signupCard').classList.add('hidden');
      document.getElementById('verifyCard').classList.add('hidden');
      document.getElementById('loginCard').classList.remove('hidden');
    }

    function showSignup() {
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('verifyCard').classList.add('hidden');
      document.getElementById('signupCard').classList.remove('hidden');
    }

    function showVerification() {
      document.getElementById('loginCard').classList.add('hidden');
      document.getElementById('signupCard').classList.add('hidden');
      document.getElementById('verifyCard').classList.remove('hidden');
      document.querySelectorAll('.code-input').forEach(input => input.value = '');
      document.querySelector('.code-input').focus();
    }

    function moveToNext(input, nextIndex) {
      if (input.value.length === 1) {
        const nextInput = document.querySelectorAll('.code-input')[nextIndex];
        if (nextInput) nextInput.focus();
      }
    }

    async function signup() {
      const username = document.getElementById('signupUsername').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;

      if (!username || !email || !password) {
        return showAlert('Please fill all fields');
      }

      if (username.length < 3) {
        return showAlert('Username must be at least 3 characters');
      }

      if (password.length < 6) {
        return showAlert('Password must be at least 6 characters');
      }

      const formData = new FormData();
      formData.append('action', 'signup');
      formData.append('username', username);
      formData.append('email', email);
      formData.append('password', password);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          state.pendingUser = { username, email, password };
          showVerification();
          showAlert('Verification code sent to your email!');
        } else {
          showAlert(data.message || 'Signup failed');
        }
      } catch (error) {
        console.error('Signup error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function verifyEmail() {
      const codeInputs = document.querySelectorAll('.code-input');
      const code = Array.from(codeInputs).map(input => input.value).join('');

      if (code.length !== 6) {
        return showAlert('Please enter the 6-digit code');
      }

      const formData = new FormData();
      formData.append('action', 'verifyEmail');
      formData.append('username', state.pendingUser.username);
      formData.append('email', state.pendingUser.email);
      formData.append('password', state.pendingUser.password);
      formData.append('code', code);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          showAlert('Account verified successfully! You can now login.');
          showLogin();
          state.pendingUser = null;
        } else {
          showAlert(data.message || 'Verification failed');
        }
      } catch (error) {
        console.error('Verification error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function resendCode() {
      if (!state.pendingUser) return;

      const formData = new FormData();
      formData.append('action', 'resendCode');
      formData.append('username', state.pendingUser.username);
      formData.append('email', state.pendingUser.email);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          showAlert('New verification code sent!');
        } else {
          showAlert(data.message || 'Failed to resend code');
        }
      } catch (error) {
        console.error('Resend code error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function login() {
      const username = document.getElementById('loginUsername').value.trim();
      const password = document.getElementById('loginPassword').value;

      if (!username || !password) {
        return showAlert('Please fill all fields');
      }

      const formData = new FormData();
      formData.append('action', 'login');
      formData.append('username', username);
      formData.append('password', password);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          state.user = data.user;
          localStorage.setItem('insignia_user', JSON.stringify({ username }));
          showDashboard();
          showAlert('Login successful! Welcome to Insignia.');
        } else {
          showAlert(data.message || 'Login failed');
        }
      } catch (error) {
        console.error('Login error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function restoreSession(username) {
      try {
        const response = await fetch(MAIN_SCRIPT_URL + '?action=getUserData&username=' + encodeURIComponent(username) + '&t=' + Date.now());
        const data = await response.json();
        
        if (data.status === 'success') {
          state.user = data.user;
          showDashboard();
        } else {
          localStorage.removeItem('insignia_user');
        }
      } catch (error) {
        console.error('Restore session error:', error);
        localStorage.removeItem('insignia_user');
      }
    }

    async function showDashboard() {
      document.getElementById('authScreens').classList.add('hidden');
      document.getElementById('dashboard').classList.remove('hidden');
      document.getElementById('chatToggle').classList.remove('hidden');

      // Update user info
      document.getElementById('displayUsername').textContent = state.user.username;
      document.getElementById('userAvatar').textContent = state.user.username[0].toUpperCase();
      document.getElementById('balanceValue').textContent = Number(state.user.balance).toLocaleString();
      document.getElementById('usdBalanceValue').textContent = '$' + Number(state.user.balanceUSD).toFixed(4);
      document.getElementById('bonusPointsValue').textContent = Number(state.user.bonusPoints || 0).toLocaleString();

      // Initialize chat system
      if (!chatSystem) {
        chatSystem = new ChatSystem();
      }
      await chatSystem.initialize();

      // Show work page
      showPage('work');
    }

    function showPage(page) {
      state.currentPage = page;
      
      document.querySelectorAll('.content-page').forEach(p => p.classList.add('hidden'));
      document.getElementById(page).classList.remove('hidden');
      
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => {
        if (btn.onclick && btn.onclick.toString().includes(`'${page}'`)) {
          btn.classList.add('active');
        }
      });
      
      if (page === 'offerwalls') loadOfferwalls();
      if (page === 'bonus') loadBonusCodes();
      if (page === 'cashout') loadCashoutHistory();
    }

    function toggleMenu() {
      state.menuOpen = !state.menuOpen;
      document.querySelector('.menu-toggle').classList.toggle('active');
      document.querySelector('.mobile-menu').classList.toggle('active');
      document.querySelector('.menu-overlay').classList.toggle('active');
    }

    // Chat functions
    function handleChatInput(event) {
      if (event.key === 'Enter') {
        sendChatMessage();
      }
    }

    function sendEmoji(emoji) {
      if (chatSystem) {
        chatSystem.sendMessage(emoji);
      }
    }

    function sendChatMessage() {
      if (chatSystem) {
        chatSystem.sendMessage();
      }
    }

    function toggleChat() {
      if (chatSystem) {
        chatSystem.toggleChat();
      }
    }

    // Work submission
    async function submitWork() {
      if (!state.user) return;

      const text = document.getElementById('workInput').value.trim();
      if (!text) return showAlert('Please describe the questions you answered');

      const formData = new FormData();
      formData.append('action', 'submitWork');
      formData.append('username', state.user.username);
      formData.append('submission', text);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();
        showAlert(data.message);
        document.getElementById('workInput').value = '';
      } catch (error) {
        console.error('Submit work error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    // Cashout functions
    document.getElementById('rewardSelect').onchange = function() {
      document.getElementById('cashoutBtn').disabled = !this.value;
    };

    async function submitCashout() {
      if (!state.user) return;

      const amount = document.getElementById('rewardSelect').value;
      if (!amount) return showAlert('Please select a reward');

      const reward = document.getElementById('rewardSelect').selectedOptions[0].text;

      const formData = new FormData();
      formData.append('action', 'submitCashout');
      formData.append('username', state.user.username);
      formData.append('reward', reward);
      formData.append('amount', amount);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();
        showAlert(data.message);

        document.getElementById('rewardSelect').value = '';
        document.getElementById('cashoutBtn').disabled = true;
        loadCashoutHistory();
      } catch (error) {
        console.error('Cashout error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    async function loadCashoutHistory() {
      if (!state.user) return;
      
      try {
        const response = await fetch(MAIN_SCRIPT_URL + '?action=getCashoutHistory&username=' + state.user.username + '&t=' + Date.now());
        const data = await response.json();
        const container = document.getElementById('cashoutHistory');
        
        if (data.status === 'success' && data.history && data.history.length > 0) {
          container.innerHTML = data.history.map(item => `
            <div class="history-item">
              <div class="flex justify-between items-center">
                <div>
                  <strong>${item.reward}</strong>
                  <span class="text-sm text-gray"> - $${item.amount}</span>
                </div>
                <span class="history-status status-${item.status.toLowerCase()}">${item.status}</span>
              </div>
              <div class="text-sm text-gray mt-2">
                ${new Date(item.date).toLocaleDateString()}
                ${item.adminNotes ? `<div class="mt-1"><strong>Note:</strong> ${item.adminNotes}</div>` : ''}
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = '<p>No cashout history yet.</p>';
        }
      } catch (error) {
        console.error('Load history error:', error);
        container.innerHTML = '<p>Error loading history</p>';
      }
    }

    // Offerwalls functions
    async function loadOfferwalls() {
      if (!state.user) return;
      
      try {
        const response = await fetch(MAIN_SCRIPT_URL + '?action=getOfferwalls&username=' + state.user.username + '&t=' + Date.now());
        const data = await response.json();
        const container = document.getElementById('offerwallList');
        
        if (data.status === 'success' && data.offerwalls && data.offerwalls.length > 0) {
          container.innerHTML = data.offerwalls.map(wall => {
            const hasEnoughPoints = state.user.balance >= (wall.pointsRequired || 0);
            const isUnlocked = hasEnoughPoints && (wall.status === 'active');
            
            return `
              <div class="offerwall-card">
                <div class="offerwall-header">
                  <div class="offerwall-icon">
                    <i class="fas fa-gem"></i>
                  </div>
                  <div style="flex: 1;">
                    <h3 class="font-semibold">${wall.name}</h3>
                    <p class="text-sm text-gray">Complete offers to earn rewards</p>
                  </div>
                  <span class="offerwall-status ${isUnlocked ? 'unlocked' : 'locked'}">
                    ${isUnlocked ? 'Unlocked' : 'Locked'}
                  </span>
                </div>
                <div class="flex gap-2">
                  <button class="btn ${!isUnlocked ? 'btn-outline' : ''}" 
                          onclick="${isUnlocked ? `openOfferwall('${wall.id}', '${wall.url}')` : 'showAlert(\'Unlock more offers by earning points!\')'}" 
                          ${!isUnlocked ? 'disabled' : ''}>
                    <i class="fas fa-play"></i>
                    Start Earning
                  </button>
                  <button class="btn btn-outline" 
                          onclick="window.open('${wall.url}', '_blank')" 
                          ${!isUnlocked ? 'disabled' : ''}>
                    <i class="fas fa-external-link-alt"></i>
                  </button>
                </div>
              </div>
            `;
          }).join('');
        } else {
          container.innerHTML = '<p>No active offerwalls at the moment</p>';
        }
      } catch (error) {
        console.error('Load offerwalls error:', error);
        container.innerHTML = '<p>Error loading offerwalls</p>';
      }
    }

    function openOfferwall(id, url) {
      document.getElementById('offerwallList').classList.add('hidden');
      document.getElementById('iframeContainer').classList.remove('hidden');
      document.getElementById('offerwallFrame').src = url;
      showAlert('Offerwall opened! Complete offers to earn rewards.');
    }

    // Bonus codes functions
    async function loadBonusCodes() {
      if (!state.user) return;
      
      try {
        const availableResponse = await fetch(MAIN_SCRIPT_URL + '?action=getBonusCodes&username=' + state.user.username + '&t=' + Date.now());
        const availableData = await availableResponse.json();
        
        const historyResponse = await fetch(MAIN_SCRIPT_URL + '?action=getUserBonusHistory&username=' + state.user.username + '&t=' + Date.now());
        const historyData = await historyResponse.json();
        
        updateAvailableCodes(availableData);
        updateBonusHistory(historyData);
        
      } catch (error) {
        console.error('Load bonus codes error:', error);
      }
    }

    function updateAvailableCodes(data) {
      const container = document.getElementById('availableBonusCodes');
      
      if (data.status === 'success' && data.availableCodes && data.availableCodes.length > 0) {
        container.innerHTML = data.availableCodes.map(code => `
          <div class="bonus-item">
            <div class="bonus-code">${code.code}</div>
            <div class="bonus-reward">+${code.points} Points</div>
          </div>
        `).join('');
      } else {
        container.innerHTML = '<p>No available bonus codes</p>';
      }
    }

    function updateBonusHistory(data) {
      const container = document.getElementById('bonusHistory');
      
      if (data.status === 'success' && data.history && data.history.length > 0) {
        container.innerHTML = data.history.map(item => `
          <div class="bonus-item">
            <div class="bonus-code">${item.code}</div>
            <div class="bonus-reward">+${item.points} Points</div>
            <div class="text-sm text-gray">${new Date(item.date).toLocaleDateString()}</div>
          </div>
        `).join('');
      } else {
        container.innerHTML = '<p>No bonus codes redeemed yet</p>';
      }
    }

    async function redeemBonusCode() {
      if (!state.user) return;
      
      const bonusCode = document.getElementById('bonusCodeInput').value.trim();
      if (!bonusCode) {
        return showAlert('Please enter a bonus code');
      }

      const formData = new FormData();
      formData.append('action', 'redeemBonusCode');
      formData.append('username', state.user.username);
      formData.append('bonusCode', bonusCode);

      try {
        const response = await fetch(MAIN_SCRIPT_URL, { method: 'POST', body: formData });
        const data = await response.json();

        if (data.status === 'success') {
          showAlert(data.message);
          document.getElementById('bonusCodeInput').value = '';
          
          if (data.userData) {
            state.user = data.userData;
            document.getElementById('balanceValue').textContent = Number(state.user.balance).toLocaleString();
            document.getElementById('usdBalanceValue').textContent = '$' + Number(state.user.balanceUSD).toFixed(4);
            document.getElementById('bonusPointsValue').textContent = Number(state.user.bonusPoints || 0).toLocaleString();
          }
          
          loadBonusCodes();
        } else {
          showAlert(data.message || 'Failed to redeem bonus code');
        }
      } catch (error) {
        console.error('Redeem bonus error:', error);
        showAlert('Network error. Please try again.');
      }
    }

    // Alert modal
    function showAlert(msg) {
      document.getElementById('alertMessage').textContent = msg;
      document.getElementById('alertModal').classList.add('active');
    }

    function closeAlert() {
      document.getElementById('alertModal').classList.remove('active');
    }

    function logout() {
      if (chatSystem) {
        chatSystem.cleanup();
        chatSystem = null;
      }
      localStorage.removeItem('insignia_user');
      state.user = null;
      location.reload();
    }

    // Initialize
    window.onload = init;
  </script>
</body>
</html>
